!function(a,b){a.widget("ui.rotatable",a.ui.mouse,{widgetEventPrefix:"rotate",options:{handle:!1,angle:!1,wheelRotate:!0,snap:!1,step:22.5,rotationCenterX:!1,rotationCenterY:!1,start:null,rotate:null,stop:null},rotationCenterX:function(a){return a===b?this.options.rotationCenterX:void(this.options.rotationCenterX=a)},rotationCenterY:function(a){return a===b?this.options.rotationCenterY:void(this.options.rotationCenterY=a)},handle:function(a){return a===b?this.options.handle:void(this.options.handle=a)},angle:function(a){return a===b?this.options.angle:(this.options.angle=a,this.elementCurrentAngle=a,void this.performRotation(this.options.angle))},_create:function(){var b;this.options.handle?b=this.options.handle:(b=a(document.createElement("div")),b.addClass("ui-rotatable-handle")),this.listeners={rotateElement:a.proxy(this.rotateElement,this),startRotate:a.proxy(this.startRotate,this),stopRotate:a.proxy(this.stopRotate,this),wheelRotate:a.proxy(this.wheelRotate,this)},this.options.wheelRotate&&this.element.bind("wheel",this.listeners.wheelRotate),b.draggable({helper:"clone",start:this.dragStart,handle:b}),b.bind("mousedown",this.listeners.startRotate),b.appendTo(this.element),0!=this.options.angle?(this.elementCurrentAngle=this.options.angle,this.performRotation(this.elementCurrentAngle)):this.elementCurrentAngle=0},_destroy:function(){this.element.removeClass("ui-rotatable"),this.element.find(".ui-rotatable-handle").remove(),this.options.wheelRotate&&this.element.unbind("wheel",this.listeners.wheelRotate)},performRotation:function(a){this.element.css("transform-origin",this.options.rotationCenterX+"% "+this.options.rotationCenterY+"%"),this.element.css("-ms-transform-origin",this.options.rotationCenterX+"% "+this.options.rotationCenterY+"%"),this.element.css("-webkit-transform-origin",this.options.rotationCenterX+"% "+this.options.rotationCenterY+"%"),this.element.css("transform","rotate("+a+"rad)"),this.element.css("-moz-transform","rotate("+a+"rad)"),this.element.css("-webkit-transform","rotate("+a+"rad)"),this.element.css("-o-transform","rotate("+a+"rad)")},getElementOffset:function(){this.performRotation(0);var a=this.element.offset();return this.performRotation(this.elementCurrentAngle),a},getElementCenter:function(){var a=this.getElementOffset();if(this.options.rotationCenterX===!1)var b=a.left+this.element.width()/2,c=a.top+this.element.height()/2;else var b=a.left+this.element.width()/100*this.options.rotationCenterX,c=a.top+this.element.height()/100*this.options.rotationCenterY;return Array(b,c)},dragStart:function(a){if(this.element)return!1},startRotate:function(b){var c=this.getElementCenter(),d=b.pageX-c[0],e=b.pageY-c[1];return this.mouseStartAngle=Math.atan2(e,d),this.elementStartAngle=this.elementCurrentAngle,this.hasRotated=!1,this._propagate("start",b),a(document).bind("mousemove",this.listeners.rotateElement),a(document).bind("mouseup",this.listeners.stopRotate),!1},rotateElement:function(a){if(!this.element||this.element.disabled)return!1;var b=this.getRotateAngle(a);this.performRotation(b);var c=this.elementCurrentAngle;return this.elementCurrentAngle=b,this._propagate("rotate",a),c!=b&&(this._trigger("rotate",a,this.ui()),this.hasRotated=!0),!1},stopRotate:function(b){if(this.element&&!this.element.disabled)return a(document).unbind("mousemove",this.listeners.rotateElement),a(document).unbind("mouseup",this.listeners.stopRotate),this.elementStopAngle=this.elementCurrentAngle,this.hasRotated&&this._propagate("stop",b),setTimeout(function(){this.element=!1},10),!1},getRotateAngle:function(a){var b=this.getElementCenter(),c=a.pageX-b[0],d=a.pageY-b[1],e=Math.atan2(d,c),f=e-this.mouseStartAngle+this.elementStartAngle;if(this.options.snap||a.shiftKey){var g=f/Math.PI*180;g=Math.round(g/this.options.step)*this.options.step,f=g*Math.PI/180}return f},wheelRotate:function(a){var b=Math.round(a.originalEvent.deltaY/10)*Math.PI/180;b=this.elementCurrentAngle+b,this.angle(b),this._trigger("rotate",a,this.ui())},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"rotate"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{api:this,element:this.element,angle:{start:this.elementStartAngle,current:this.elementCurrentAngle,stop:this.elementStopAngle}}}})}(jQuery);